<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSYlanguages</title>
    <link rel="stylesheet" href="src/css/main.css">
</head>
<body>
    <div class="container">
        <h1 data-transliterable>COSYlanguages</h1>
        
        <div class="menu-section">
            <label for="language" data-transliterable>🌎 Choose Your Language:</label>
            <select id="language">
                <option value="" data-transliterable>Your Language</option>
                <option value="COSYenglish" data-bg="COSYenglish">COSYenglish</option>
                <option value="COSYfrançais" data-bg="COSYfrançais">COSYfrançais</option>
                <option value="COSYitaliano" data-bg="COSYitaliano">COSYitaliano</option>
                <option value="COSYespañol" data-bg="COSYespañol">COSYespañol</option>
                <option value="COSYportuguês" data-bg="COSYportuguês">COSYportuguês</option>
                <option value="COSYdeutsch" data-bg="COSYdeutsch">COSYdeutsch</option>
                <option value="ΚΟΖΥελληνικά" data-bg="ΚΟΖΥελληνικά">ΚΟΖΥελληνικά</option>
                <option value="ТАКОЙрусский" data-bg="ТАКОЙрусский">ТАКОЙрусский</option>
                <option value="ԾՈՍՅհայկական" data-bg="ԾՈՍՅհայկական">ԾՈՍՅհայկական</option>
                <option value="COSYbrezhoneg" data-bg="COSYbrezhoneg">COSYbrezhoneg</option>
                <option value="COSYtatarça" data-bg="COSYtatarça">COSYtatarça</option>
                <option value="COSYbashkort" data-bg="COSYbashkort">COSYbashkort</option>
            </select>
            <button id="toggle-latinization-btn" title="Toggle Latinization" style="margin-left: 10px; padding: 5px 10px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Latinize: On</button>
        </div>
        
        <div class="menu-section">
            <label for="day" data-transliterable>📅 Choose Your Day:</label>
            <select id="day" aria-label="Choose your day">
                <option value="" data-transliterable>Day</option>
                <!-- Days will be populated by JavaScript -->
            </select>
            <div class="day-range">
                <div>
                    <label for="day-from" data-transliterable>Day From:</label>
                    <select id="day-from" aria-label="Day from">
                        <option value="" data-transliterable>From</option>
                    </select>
                </div>
                <div>
                    <label for="day-to" data-transliterable>Day To:</label>
                    <select id="day-to" aria-label="Day to">
                        <option value="" data-transliterable>To</option>
                    </select>
                </div>
            </div>
            <div id="selected-day-name-display" class="menu-section-subtitle" style="display:none;"></div>
        </div>
        
        <div class="menu-section">
            <label id="choose-practice-label" data-transliterable>🧭 Choose Your Practice:</label>
            <div class="practice-types" role="navigation" aria-label="Practice type menu">
                <button id="vocabulary-btn" class="btn-primary" aria-label="Vocabulary" title="Vocabulary" role="button" data-transliterable>🔠 Vocabulary</button>
                <button id="grammar-btn" class="btn-primary" aria-label="Grammar" title="Grammar" role="button" data-transliterable>🧩 Grammar</button>
                <button id="reading-btn" class="btn-primary" aria-label="Reading" title="Reading" role="button" data-transliterable>📚 Reading</button>
                <button id="speaking-btn" class="btn-primary" aria-label="Speaking" title="Speaking" role="button" data-transliterable>🗣️ Speaking</button>
                <button id="writing-btn" class="btn-primary" aria-label="Writing" title="Writing" role="button" data-transliterable>✍️ Writing</button>
                <button id="practice-all-btn" class="btn-primary option-btn" aria-label="Practice All" title="Practice All" role="button" data-transliterable>🔄 Practice All</button>
            </div>
            
            <div id="vocabulary-options" class="practice-options" aria-label="Vocabulary options" role="region">
                <div class="vocabulary-options">
                    <button id="random-word-btn" class="btn-secondary option-btn" aria-label="Random Word" title="Random Word" role="button" data-transliterable>🔤 Random Word</button>
                    <button id="random-image-btn" class="btn-secondary option-btn" aria-label="Random Image" title="Random Image" role="button" data-transliterable>🖼️ Random Image</button>
                    <button id="listening-btn" class="btn-secondary option-btn" aria-label="Listening" title="Listening" role="button" data-transliterable>🎧 Listening</button>
                    <button id="practice-all-vocab-btn" class="btn-secondary option-btn" aria-label="Practice All Vocabulary" title="Practice All Vocabulary" role="button" data-transliterable>🔄 Practice All</button>
                </div>
            </div>
            
            <div id="grammar-options" class="practice-options" aria-label="Grammar options" role="region">
                <div class="grammar-options">
                    <button id="gender-btn" class="btn-secondary option-btn" aria-label="Gender" title="Gender" role="button" data-transliterable>✨ Gender</button>
                    <button id="verbs-btn" class="btn-secondary option-btn" aria-label="Verbs" title="Verbs" role="button" data-transliterable>🧩 Verbs</button>
                    <button id="possessives-btn" class="btn-secondary option-btn" aria-label="Possessives" title="Possessives" role="button" data-transliterable>🔠 Possessives</button>
                    <button id="practice-all-grammar-btn" class="btn-secondary option-btn" aria-label="Practice All Grammar" title="Practice All Grammar" role="button" data-transliterable>🔄 Practice All</button>
                </div>
            </div>

            <div id="reading-options" class="practice-options" aria-label="Reading options" role="region">
                <div class="reading-options">
                    <button id="story-btn" class="btn-secondary option-btn" aria-label="Story" title="Story" role="button" data-transliterable>📖 Story</button>
                    <button id="interesting-fact-btn" class="btn-secondary option-btn" aria-label="Interesting facts" title="Interesting facts" role="button" data-transliterable>🔄 Interesting facts</button>
                </div>
            </div>
            
            <div id="speaking-options" class="practice-options" aria-label="Speaking options" role="region">
                <div class="speaking-options">
                <button id="question-practice-btn" class="btn-secondary option-btn" aria-label="Question" title="Question" role="button" data-transliterable>❓ Question</button>
                <button id="monologue-btn" class="btn-secondary option-btn" aria-label="Monologue" title="Monologue" role="button" data-transliterable>💬 Monologue</button>
                <button id="role-play-btn" class="btn-secondary option-btn" aria-label="Role Play" title="Role Play" role="button" data-transliterable>🎭 Role Play</button>
                <button id="practice-all-speaking-btn" class="btn-secondary option-btn" aria-label="Practice All Speaking" title="Practice All Speaking" role="button" data-transliterable>🔄 Practice All</button>
                </div>
            </div>

            <div id="writing-options" class="practice-options" aria-label="Writing options" role="region">
                <div class="writing-options">
                <button id="writing-question-btn" class="btn-secondary option-btn" aria-label="Question" title="Question" role="button" data-transliterable>❓ Question</button>
                <button id="storytelling-btn" class="btn-secondary option-btn" aria-label="Storytelling" title="Storytelling" role="button" data-transliterable>📜 Storytelling</button>
                <button id="diary-btn" class="btn-secondary option-btn" aria-label="Diary" title="Diary" role="button" data-transliterable>📔 Diary</button>
                </div>
            </div>  
        </div>
        
        <div id="result" class="result-area flex-center"></div>
    </div>

    <script>

        // Practice type buttons
        const vocabularyBtn = document.getElementById('vocabulary-btn');
        const grammarBtn = document.getElementById('grammar-btn');
        const readingBtn = document.getElementById('reading-btn');
        const speakingBtn = document.getElementById('speaking-btn');
        const writingBtn = document.getElementById('writing-btn');

        const vocabularyOptions = document.getElementById('vocabulary-options');
        const grammarOptions = document.getElementById('grammar-options');
        const readingOptions = document.getElementById('reading-options');
        const speakingOptions = document.getElementById('speaking-options');
        const writingOptions = document.getElementById('writing-options');

        // Hide all options initially using a more robust approach
        const allOptionPanelsToHide = [
            vocabularyOptions, // Already defined above
            grammarOptions,    // Already defined above
            readingOptions,    // Already defined above
            speakingOptions,   // Already defined above
            writingOptions     // Already defined above
        ];

        allOptionPanelsToHide.forEach(panel => {
            if (panel) { // Check if the element actually exists
                panel.style.display = 'none';
            }
        });

        // Show Practice All button on load
        const practiceAllBtn = document.getElementById('practice-all-btn');
        practiceAllBtn.style.display = 'block';

        function restoreUserSelection() {
            const languageSelect = document.getElementById('language');
            const daySelect = document.getElementById('day');
            const dayFromSelect = document.getElementById('day-from'); // Keep for reference if other logic needs it
            const dayToSelect = document.getElementById('day-to');   // Keep for reference

            const savedLanguage = localStorage.getItem('selectedLanguage');
            // const savedDay = localStorage.getItem('selectedDay'); // No longer retrieving
            // const savedDayFrom = localStorage.getItem('selectedDayFrom'); // No longer retrieving
            // const savedDayTo = localStorage.getItem('selectedDayTo'); // No longer retrieving

            if (savedLanguage && languageSelect) {
                languageSelect.value = savedLanguage;
            } else if (languageSelect) { 
                languageSelect.value = "";
            }

            // Dispatch change event for language to trigger its UI updates
            if (languageSelect && (savedLanguage || languageSelect.value === "")) {
                 languageSelect.dispatchEvent(new Event('change'));
            }

            // Day selections are no longer restored from localStorage here.
            // daySelect.value, dayFromSelect.value, dayToSelect.value will remain at their default (empty/placeholder).
            // if (savedDay && daySelect) {
            //     daySelect.value = savedDay;
            // }
            // if (savedDayFrom && dayFromSelect) {
            //     dayFromSelect.value = savedDayFrom;
            // }
            // if (savedDayTo && dayToSelect) {
            //     dayToSelect.value = savedDayTo;
            // }
            
            // The call to updateDaySelectorsVisibility(true) in event-listeners-setup.js 
            // will handle the initial correct display of both single and range day selectors.
            // No specific 'change' events for day selectors need to be dispatched here for restoration.
            // The old call to updateDaySelectors() is removed as part of this logic change.
            // if (typeof updateDaySelectors === 'function') { // This was the old function name
            //      updateDaySelectors(); 
            // }
            
            // The relevant 'change' events on day selectors that would trigger updateUIVisibilityForDay
            // are handled by the user interaction or by the initial call in event-listeners-setup.js.
            // No need to dispatch day 'change' events here anymore.
            // if (savedDay && daySelect) {
            //      daySelect.dispatchEvent(new Event('change'));
            // } else if (savedDayFrom && dayFromSelect) {
            //      dayFromSelect.dispatchEvent(new Event('change'));
            // }
        }

// Show all main practice type buttons
function showAllMainPracticeTypes() {
    ['vocabulary-btn', 'grammar-btn', 'reading-btn', 'speaking-btn', 'writing-btn', 'practice-all-btn'].forEach(id => {
        document.getElementById(id).style.display = 'inline-block';
        document.getElementById(id).classList.remove('active-main-btn');
    });
}

function hideOtherMainPracticeTypes(selectedId) {
    ['vocabulary-btn', 'grammar-btn', 'speaking-btn', 'reading-btn', 'writing-btn', 'practice-all-btn'].forEach(id => {
         if (id !== selectedId) {
            document.getElementById(id).style.display = 'none';
        } else {
            document.getElementById(id).classList.add('active-main-btn');
        }
    });
}
        // --- Hide other options when one is selected ---
        function hideOtherVocabularyOptions(selectedId) {
            document.querySelectorAll('#vocabulary-options button').forEach(btn => {
                if (btn.id !== selectedId) btn.style.display = 'none';
            });
        }
        function showAllVocabularyOptions() {
            document.querySelectorAll('#vocabulary-options button').forEach(btn => {
                btn.style.display = '';
            });
        }
        function hideOtherGrammarOptions(selectedId) {
            document.querySelectorAll('#grammar-options button').forEach(btn => {
                if (btn.id !== selectedId) btn.style.display = 'none';
            });
        }
        function showAllGrammarOptions() {
            document.querySelectorAll('#grammar-options button').forEach(btn => {
                btn.style.display = '';
            });
        }
        function hideOtherReadingOptions(selectedId) {
            document.querySelectorAll('#reading-options button').forEach(btn => {
                if (btn.id !== selectedId) btn.style.display = 'none';
            });
        }
        function showAllReadingOptions() {
            document.querySelectorAll('#reading-options button').forEach(btn => {
                btn.style.display = '';
            });
        }
        function hideOtherSpeakingOptions(selectedId) {
            document.querySelectorAll('#speaking-options button').forEach(btn => {
                if (btn.id !== selectedId) btn.style.display = 'none';
            });
        }
        function showAllSpeakingOptions() {
            document.querySelectorAll('#speaking-options button').forEach(btn => {
                btn.style.display = '';
            });
        }
        function hideOtherWritingOptions(selectedId) {
            document.querySelectorAll('#writing-options button').forEach(btn => {
                if (btn.id !== selectedId) btn.style.display = 'none';
            });
        }
        function showAllWritingOptions() {
            document.querySelectorAll('#writing-options button').forEach(btn => {
                btn.style.display = '';
            });
        }

        // Helper: go back to main menu
        function goBackToMainMenu() {
            showAllMainPracticeTypes();
            showAllVocabularyOptions && showAllVocabularyOptions();
            showAllGrammarOptions && showAllGrammarOptions();
            showAllReadingOptions && showAllReadingOptions();
            showAllSpeakingOptions && showAllSpeakingOptions();
            showAllWritingOptions && showAllWritingOptions();
            if (vocabularyOptions) vocabularyOptions.style.display = 'none';
            if (grammarOptions) grammarOptions.style.display = 'none';
            if (readingOptions) readingOptions.style.display = 'none';
            if (speakingOptions) speakingOptions.style.display = 'none';
            if (writingOptions) writingOptions.style.display = 'none';
            if (practiceAllBtn) practiceAllBtn.style.display = 'block';
            if (document.getElementById('result')) document.getElementById('result').innerHTML = '';
            showPracticeAllButtons();
        }

        // Change background flag on language select
        const languageSelect = document.getElementById('language');
        languageSelect.addEventListener('change', function() {
            const lang = languageSelect.value;
            // Remove any previous flag class
            document.body.className = document.body.className
                .split(' ') // split classes
                .filter(c => !c.startsWith('flag-')) // remove flag- classes
                .join(' ');
            if (lang) {
                document.body.classList.add('flag-' + lang);
            }
        });
    
        // Helper: get selected days (single or range)
        function getSelectedDays() {
            const day = document.getElementById('day').value;
            const dayFrom = document.getElementById('day-from').value;
            const dayTo = document.getElementById('day-to').value;
            console.log("DEBUG_SIM: getSelectedDays - day:", day, "dayFrom:", dayFrom, "dayTo:", dayTo);

            if (day) {
                console.log("DEBUG_SIM: getSelectedDays - returning array:", [day]);
                return [day];
            } else if (dayFrom && dayTo && Number(dayFrom) <= Number(dayTo)) {
                const from = Number(dayFrom);
                const to = Number(dayTo);
                const days = [];
                for (let i = from; i <= to; i++) days.push(String(i));
                console.log("DEBUG_SIM: getSelectedDays - returning array:", days);
                return days;
            } else {
                console.log("DEBUG_SIM: getSelectedDays - returning empty array");
                return [];
            }
        }

        // Restore all main practice type buttons when returning to menu
        function restoreMenu() {
            showAllMainPracticeTypes();
            showAllVocabularyOptions();
            showAllGrammarOptions();
            showAllReadingOptions();
            showAllSpeakingOptions();
            vocabularyOptions.style.display = 'none';
            grammarOptions.style.display = 'none';
            readingOptions.style.display = 'none';
            speakingOptions.style.display = 'none';
            practiceAllBtn.style.display = 'block';
            // Optionally clear result area
            document.getElementById('result').innerHTML = '';
        }

// daySelect, dayFromSelect, dayToSelect are not defined here. Assuming they are defined in event-listeners-setup.js or language-handler.js
// If not, these lines will cause an error. For now, I'll assume they are defined elsewhere.
// daySelect.addEventListener('change', updateDaySelectors);
// dayFromSelect.addEventListener('change', updateDaySelectors);
// dayToSelect.addEventListener('change', updateDaySelectors);

// After progress stats rendering (wherever progress stats are shown):
// const statsContainer = document.getElementById('progress-stats-container'); // This is likely not available here.
// if (statsContainer && !document.getElementById('reset-progress-btn')) {
//   const resetBtn = document.createElement('button');
//   resetBtn.id = 'reset-progress-btn';
//   resetBtn.className = 'btn-secondary margin-top-18 margin-bottom-8 font-size-11 text-center';
//   resetBtn.textContent = (translations[lang]||translations['COSYenglish']).resetProgress || 'Reset Progress';
//   resetBtn.onclick = function() {
//     if (confirm((translations[lang]||translations['COSYenglish']).resetConfirm || 'Are you sure you want to reset your progress?')) {
//       localStorage.clear();
//       location.reload();
//     }
//   };
//   statsContainer.appendChild(resetBtn);
// }
    </script>

    <script src="src/js/utils.js"></script>
    <script src="src/js/ui/translations.js"></script>
    <script src="src/js/transliteration.js"></script>
    <script src="src/js/exercises/vocabulary.js"></script>
    <script src="src/js/speech-features.js"></script>
    <script src="src/js/ui/ui-visibility.js"></script>
    <script src="src/js/exercises/vocabulary-progression.js" defer></script>
    <script src="src/js/exercise-progression.js" defer></script>
    <script src="src/js/exercises/grammar.js"></script>
    <script src="src/js/exercises/speaking.js"></script> 
    <script src="src/js/exercises/writing.js"></script>
    <script src="src/js/exercises/reading.js"></script> 
    <script src="src/js/buttons.js"></script>
    <script src="src/js/language-handler.js"></script>
    <script src="src/js/latinizer.js"></script>
    <script src="src/js/event-listeners-setup.js"></script>
    <script src="src/js/achievements-data.js"></script> 
    <!-- interactive.js should be loaded after all feature scripts -->
    <script src="src/js/ui/interactive.js"></script>



</body>
</html>
